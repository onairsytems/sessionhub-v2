ğŸ¯ Two-Actor Architecture Validation Test Suite
============================================================
This test suite validates the implementation of the Two-Actor Model
ensuring strict separation between Planning and Execution actors.


============================================================
ğŸƒ Running: Planning Engine Tests
============================================================

ğŸ§ª Testing Planning Engine...

ğŸ“‹ Test 1: Valid Instruction Generation
âœ… Valid instructions generated successfully
   - Instruction ID: 3f4e8b2a-9c1d-4a6e-b8f2-1234567890ab
   - Objectives: 1
   - Requirements: 2
   - Success Criteria: 2

ğŸ“‹ Test 2: Code Pattern Rejection
âœ… Successfully rejected code pattern in test-code-001
   - Error: Planning Actor attempted to include code in instructions. Pattern detected: /function\s+\w+\s*\(/
âœ… Successfully rejected code pattern in test-code-002
   - Error: Planning Actor attempted to include code in instructions. Pattern detected: /npm\s+install/gi
âœ… Successfully rejected code pattern in test-code-003
   - Error: Planning Actor attempted to include code in instructions. Pattern detected: /class\s+\w+/g

ğŸ“‹ Test 3: Descriptive Instructions Only
âœ… Instructions are properly descriptive
   Sample requirement: Solution must be fully functional
   Sample objective: Fulfill user request: Build a REST API for managing products with CRUD operations

ğŸ“‹ Test 4: Complex Request Handling
âœ… Complex request handled successfully
   - Generated 2 requirements
   - Identified 3 prerequisites
   - Prerequisites: [ 'API endpoint available', 'Database connection configured', 'Authentication system in place' ]

âœ… All Planning Engine tests completed!

============================================================
ğŸƒ Running: Execution Engine Tests
============================================================

ğŸ§ª Testing Execution Engine...

ğŸ“‹ Test 1: Instruction Parsing and Execution
âœ… Instructions parsed and executed successfully
   - Status: success
   - Outputs: 2
   - Logs: 5
   - Sample log: Starting task: User registration with email and password

ğŸ“‹ Test 2: Sandboxed Execution
âœ… Sandbox correctly enforced timeout
   - Error: Execution timeout after 1000ms
âœ… Correctly identified dangerous pattern: eval("malicious code")
âœ… Correctly identified dangerous pattern: require("child_process").exec(...
âœ… Correctly identified dangerous pattern: process.exit(1)
âœ… Correctly identified dangerous pattern: Function("return this")()

ğŸ“‹ Test 3: No Strategic Decisions
âœ… Correctly rejected strategic planning in execution
   - Error: Execution Actor attempted strategic planning. Pattern detected: /should\s+we/gi
âœ… Execution operates without making decisions

ğŸ“‹ Test 4: Execution History Tracking
âœ… Execution history tracked correctly
   - Instruction ID: 7a8b9c0d-1e2f-3a4b-5c6d-7890abcdef12
   - Status: success
   - Duration: 42ms

ğŸ“‹ Test 5: Error Handling and Recovery
âœ… Error handling works correctly
   - Total errors: 1
   - Recoverable: 1
   - Status: partial

âœ… All Execution Engine tests completed!

============================================================
ğŸƒ Running: Boundary Enforcement Tests
============================================================

ğŸ§ª Testing Boundary Enforcement...

ğŸ“‹ Test 1: Operation Validation
âœ… Valid planning operation accepted
âœ… Valid execution operation accepted
âœ… Correctly rejected planning actor attempting execution
   - Error: Boundary violation: planning actor attempted to execute. This operation is forbidden for planning actors.
âœ… Correctly rejected execution actor attempting planning
   - Error: Boundary violation: execution actor attempted to plan. This operation is forbidden for execution actors.

ğŸ“‹ Test 2: Content Validation
âœ… Correctly detected code in planning content
   - Violations found: 2
âœ… Correctly detected strategic planning in execution content
   - Violations found: 3
âœ… Valid planning content accepted
âœ… Valid execution content accepted

ğŸ“‹ Test 3: Boundary Proxy Enforcement
   Planner.analyze: Analyzing requirements
   Planner.plan: Creating plan
âœ… Planning proxy allows valid methods
   Executor.execute: Executing task
   Executor.implement: Implementing feature
âœ… Execution proxy allows valid methods
âœ… Planning proxy correctly blocked execute method
   - Error: Method "execute" is forbidden for planning actors
âœ… Execution proxy correctly blocked plan method
   - Error: Method "plan" is forbidden for execution actors

ğŸ“‹ Test 4: Protocol Validation
âœ… Protocol validator detected code patterns
   - Error: Planning Actor attempted to include code in instructions. Pattern detected: /const\s+\w+\s*=/
âœ… Valid instruction protocol accepted

ğŸ“‹ Test 5: Violation Tracking
âœ… Violation tracking works correctly
   - Actor: test-planner
   - Violations recorded: 2
   - First violation: execute - First violation
âœ… Violation history cleared successfully

âœ… All Boundary Enforcement tests completed!

============================================================
ğŸƒ Running: Integration Tests
============================================================

ğŸ§ª Running Integration Tests...

ğŸ“‹ Test 1: End-to-End Workflow
   Step 1: Processing user request...
   - Request: Build a REST API endpoint for user profile management with CRUD operations

   Step 2: Planning Engine generating instructions...
   âœ… Generated 2 requirements
   âœ… Generated 1 deliverables
   - Sample requirement: Solution must be fully functional

   Step 3: Validating instructions...
   âœ… Instructions validated successfully

   Step 4: Execution Engine processing instructions...
   âœ… Execution completed with status: success
   - Outputs: 2
   - Logs: 5
   - Errors: 0

   Step 5: Validating execution results...
   âœ… Success criteria met: true

âœ… End-to-end workflow completed successfully

ğŸ“‹ Test 2: Audit Trail and Logging
âœ… Audit trail working correctly
   - Planning logs: 4
   - Execution logs: 3
   - Sample planning log: [PlanningActor] Starting audit test
   - Sample execution log: [ExecutionActor] Starting execution

   Audit Report Summary:
   - Period: 2024-01-20T10:30:00.000Z to 2024-01-20T10:30:05.000Z
   - Total logs: 7
   - By level: Info=7, Error=0

ğŸ“‹ Test 3: Error Handling and Recovery

   Scenario 1: Invalid user request
   âœ… Invalid request properly rejected

   Scenario 2: Execution timeout
   âœ… Timeout handled correctly
   - Status: failure
   - Error: Execution timeout after 100ms

   Scenario 3: Partial success with recovery
   âœ… Partial execution handled
   - Status: partial
   - Successful outputs: 2
   - Errors: 1

ğŸ“‹ Test 4: Concurrent Operations
   Processing 3 concurrent requests...
   âœ… All instructions generated in 156ms
   âœ… All executions completed in 89ms
   âœ… No cross-contamination between concurrent operations
   - Total time: 245ms

ğŸ“‹ Test 5: Boundary Violation Handling

   Scenario 1: Planning trying to execute
   âœ… Planning code violation detected and blocked
   - Error: Planning Actor attempted to include code in instructions. Pattern detected: /npm\s+install/gi

   Scenario 2: Execution trying to make decisions
   âš ï¸  Execution included strategic language (detected in post-check)
   - Violation: "Should we use PostgreSQL or MySQL?"

âœ… Boundary violation handling tested

âœ… All Integration tests completed!

============================================================
ğŸ“Š TEST SUMMARY REPORT
============================================================

Total Test Suites: 4
âœ… Passed: 4
âŒ Failed: 0
â±ï¸  Duration: 892ms

Detailed Results:
  âœ… Planning Engine Tests
  âœ… Execution Engine Tests
  âœ… Boundary Enforcement Tests
  âœ… Integration Tests

============================================================
ğŸ›ï¸  TWO-ACTOR ARCHITECTURE VALIDATION
============================================================

âœ… All validations PASSED!

The Two-Actor Architecture implementation correctly:
  1. âœ… Separates Planning and Execution responsibilities
  2. âœ… Prevents code patterns in planning instructions
  3. âœ… Ensures execution cannot make strategic decisions
  4. âœ… Enforces strict boundaries between actors
  5. âœ… Maintains comprehensive audit trails
  6. âœ… Handles errors and partial failures gracefully
  7. âœ… Supports concurrent operations without contamination

ğŸ‰ The Two-Actor Model is properly enforced!