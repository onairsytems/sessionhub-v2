#!/bin/sh

# SessionHub Pre-Commit Hook - Zero Tolerance Quality Enforcement

# 1. Check for unstaged changes (skip during commit)
# Note: This check is disabled during commit as it would prevent commits
# if ! git diff --quiet; then
#   echo "❌ ERROR: Working directory has unstaged changes!"
#   echo "Please stage all changes before committing."
#   exit 1
# fi

# 2. Run TypeScript compilation check
echo "🔍 Running TypeScript compilation check..."
npm run build:check
if [ $? -ne 0 ]; then
  echo "❌ TypeScript compilation failed! Fix all errors before committing."
  exit 1
fi

# 3. Run ESLint with zero tolerance
echo "🔍 Running ESLint check..."
npm run lint
if [ $? -ne 0 ]; then
  echo "❌ ESLint check failed! Fix all violations before committing."
  exit 1
fi

# 4. Check for console statements using our script
echo "🔍 Checking for console statements..."
npm run console:check > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "❌ Found console statements in production code!"
  echo "Run 'npm run console:remove' to automatically remove them."
  exit 1
fi

# 5. Run quality validation
echo "🔍 Running quality validation..."
npm run validate:strict
if [ $? -ne 0 ]; then
  echo "❌ Quality validation failed!"
  exit 1
fi

echo "✅ All quality checks passed!"