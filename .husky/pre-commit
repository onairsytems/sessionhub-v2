#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit quality checks..."

# Run TypeScript compiler check
echo "ğŸ“˜ Checking TypeScript compilation..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript compilation failed! Fix errors before committing."
  exit 1
fi

# Run ESLint
echo "ğŸ”§ Running ESLint..."
npx eslint . --ext .ts,.tsx,.js,.jsx --max-warnings 0
if [ $? -ne 0 ]; then
  echo "âŒ ESLint found errors! Fix them before committing."
  exit 1
fi

# Run the error detection system
echo "ğŸ›¡ï¸ Running SessionHub Error Detection..."
npm run error:check
if [ $? -ne 0 ]; then
  echo "âŒ Error detection found issues! Fix them before committing."
  exit 1
fi

# Run tests
echo "ğŸ§ª Running tests..."
npm test -- --passWithNoTests
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed! Fix them before committing."
  exit 1
fi

echo "âœ… All quality checks passed! Proceeding with commit..."

# Run lint-staged for formatting
npx lint-staged